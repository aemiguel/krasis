#!/usr/bin/env bash
#
# Krasis Chat — Discovers running Krasis servers and opens an interactive
# streaming chat in the terminal.
#
# Usage:
#   ./krasis-chat                     Auto-discover and connect
#   ./krasis-chat --port 8080         Connect to specific port
#   ./krasis-chat --system "You are a helpful coding assistant."
#   ./krasis-chat --help              Show all options
#
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
VENV_DIR="$SCRIPT_DIR/.venv"

# Find Python — prefer krasis venv, fall back to ktransformers-env, then system
if [[ -f "$VENV_DIR/bin/python" ]]; then
    PYTHON_BIN="$VENV_DIR/bin/python"
elif [[ -f "$HOME/ktransformers-env/bin/python" ]]; then
    PYTHON_BIN="$HOME/ktransformers-env/bin/python"
else
    PYTHON_BIN="python3"
fi

exec "$PYTHON_BIN" -m krasis.chat "$@"
